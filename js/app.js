function drawBitmapCenteredWithRotation(useBitmap,atX,atY){canvasContext.save(),canvasContext.translate(atX,atY),canvasContext.drawImage(useBitmap,-useBitmap.width/2,-useBitmap.height/2),canvasContext.restore()}function colorRect(topLeftX,topLeftY,boxWidth,boxHeight,fillColor){canvasContext.fillStyle=fillColor,canvasContext.fillRect(topLeftX,topLeftY,boxWidth,boxHeight)}function colorCircle(centerX,centerY,radius,fillColor){canvasContext.fillStyle=fillColor,canvasContext.beginPath(),canvasContext.arc(centerX,centerY,radius,0,2*Math.PI,!0),canvasContext.fill()}function colorText(showWords,textX,textY,fillColor){canvasContext.fillStyle=fillColor,canvasContext.fillText(showWords,textX,textY)}
var warriorPic=document.createElement("img"),worldPics=[],picsToLoad=0;function countLoadedImagesAndLaunchIfREady(){0==--picsToLoad&&ImageLoadingDoneToStartGame()}function beginLoadingImage(imgVar,fileName){imgVar.onload=countLoadedImagesAndLaunchIfREady(),imgVar.src="images/"+fileName}function loadImageForWorldCode(worldCode,fileName){worldPics[worldCode]=document.createElement("img"),beginLoadingImage(worldPics[worldCode],fileName)}function loadImages(){var imageList=[{varName:warriorPic,theFile:"super1.png"},{worldType:TILE_WALL,theFile:"table.png"},{worldType:TILE_WALL1,theFile:"table1.png"},{worldType:TILE_WALL2,theFile:"table2.png"},{worldType:TILE_ROAD,theFile:"grass.png"},{worldType:TILE_DOOR_NEXT,theFile:"door.png"},{worldType:TILE_DOOR_PREV,theFile:"doorback.png"},{worldType:TILE_INBAG,theFile:"resume.png"},{worldType:TILE_BARRIER,theFile:"hr1.png"},{worldType:TILE_BARRIER2,theFile:"hr2.png"},{worldType:TILE_BARRIER3,theFile:"hr3.png"},{worldType:TILE_BARRIER4,theFile:"hr4.png"},{worldType:TILE_BARRIER5,theFile:"hr5.png"},{worldType:TILE_BARRIER6,theFile:"hr6.png"},{worldType:TILE_BARRIER7,theFile:"hr7.png"},{worldType:TILE_BARRIER8,theFile:"hr8.png"},{worldType:TILE_BARRIER9,theFile:"hr9.png"}];picsToLoad=imageList.length;for(var i=0;i<imageList.length;i++)void 0!=imageList[i].varName?beginLoadingImage(imageList[i].varName,imageList[i].theFile):loadImageForWorldCode(imageList[i].worldType,imageList[i].theFile)}
const PLAYER_MOVE_SPEED=3;function warriorClass(){this.x=75,this.y=75,this.name="---",this.keysHeld=0,this.keyHeld_North=!1,this.keyHeld_South=!1,this.keyHeld_West=!1,this.keyHeld_East=!1,this.setupInput=function(upKey,rightKey,downKey,leftKey){this.controlKeyUp=upKey,this.controlKeyRight=rightKey,this.controlKeyDown=downKey,this.controlKeyLeft=leftKey},this.reset=function(whichImage,warriorName){this.name=warriorName,this.myWarriorPic=whichImage,this.keysHeld=0;for(var eachRow=0;eachRow<WORLD_ROWS;eachRow++)for(var eachCol=0;eachCol<WORLD_COLS;eachCol++){var arrayIndex=rowColToArrayIndex(eachCol,eachRow);if(worldMap[arrayIndex]==TILE_START)return worldMap[arrayIndex]=TILE_ROAD,this.x=eachCol*WORLD_W+WORLD_W/2,void(this.y=eachRow*WORLD_H+WORLD_H/2)}},this.move=function(){var nextX=this.x,nextY=this.y;this.keyHeld_North&&(nextY-=PLAYER_MOVE_SPEED),this.keyHeld_South&&(nextY+=PLAYER_MOVE_SPEED),this.keyHeld_West&&(nextX-=PLAYER_MOVE_SPEED),this.keyHeld_East&&(nextX+=PLAYER_MOVE_SPEED);var walkIntoTileIndex=getTileIndexAtPixelCoord(nextX,nextY),walkIntoTileType=TILE_WALL||TILE_WALL1||TILE_WALL2;switch(void 0!=walkIntoTileIndex&&(walkIntoTileType=worldMap[walkIntoTileIndex]),walkIntoTileType){case TILE_ROAD:this.x=nextX,this.y=nextY;break;case TILE_DOOR_NEXT:nextLevel();break;case TILE_DOOR_PREV:prevLevel();break;case TILE_BARRIER9:case TILE_BARRIER8:case TILE_BARRIER7:case TILE_BARRIER6:case TILE_BARRIER5:case TILE_BARRIER4:case TILE_BARRIER3:case TILE_BARRIER2:case TILE_BARRIER:this.keysHeld>0?(this.keysHeld--,document.getElementById("resumeCol").innerHTML=this.keysHeld,worldMap[walkIntoTileIndex]=TILE_ROAD):document.getElementById("resumeError").innerHTML="У&nbsp;меня нет резюме, я&nbsp;не&nbsp;могу пройти.";break;case TILE_INBAG:document.getElementById("resumeError").innerHTML="",this.keysHeld++,document.getElementById("resumeCol").innerHTML=this.keysHeld,worldMap[walkIntoTileIndex]=TILE_ROAD;break;case TILE_WALL2:case TILE_WALL1:case TILE_WALL:}},this.draw=function(){drawBitmapCenteredWithRotation(this.myWarriorPic,this.x,this.y)}}
const WORLD_W=50,WORLD_H=50,WORLD_COLS=16,WORLD_ROWS=12;var levelOne=[0,0,0,1,1,1,1,1,13,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,12,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,0,0,0,4,13,1,1,0,1,1,0,0,1,12,0,12,12,1,1,1,1,4,1,0,1,1,0,0,1,0,0,1,4,1,13,1,0,0,1,0,1,1,0,0,1,0,0,1,0,0,1,13,0,0,14,0,1,1,0,0,1,0,0,1,0,0,0,1,0,0,13,0,1,1,2,0,1,0,0,7,0,0,0,8,0,0,1,0,1,1,0,1,1,0,0,12,1,0,0,1,0,0,1,0,1,1,1,1,1,1,3,1,1,1,1,13,1,1,1,1,1],levelTwo=[0,0,1,1,16,2,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,1,1,0,0,1,1,0,0,4,0,0,1,1,0,0,0,4,1,0,0,0,1,0,0,0,0,0,1,1,1,0,1,0,1,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,1,1,1,11,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,3,0,9,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,1,0,1,1,0,1,0,1,0,0,0,1,1,0,0,10,0,0,4,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0],levelThree=[1,1,1,1,1,1,2,0,16,1,1,1,1,1,1,1,1,0,0,0,0,0,0,4,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,1,1,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,1,1,0,0,4,0,6,0,0,0,5,0,4,0,0,0,1,1,1,1,0,1,0,0,0,0,0,1,0,1,1,1,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,15,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,3,1,1,0,0,0,0,0,0],levelList=[levelOne,levelTwo,levelThree],levelNow=0,worldMap=[];const TILE_ROAD=0,TILE_WALL=1,TILE_START=2,TILE_DOOR_NEXT=3,TILE_INBAG=4,TILE_BARRIER=5,TILE_BARRIER2=6,TILE_BARRIER3=7,TILE_BARRIER4=8,TILE_BARRIER5=9,TILE_BARRIER6=10,TILE_BARRIER7=11,TILE_WALL1=12,TILE_WALL2=13,TILE_BARRIER8=14,TILE_BARRIER9=15,TILE_DOOR_PREV=16;function returnTileTypeAtColRow(col,row){if(col>=0&&col<WORLD_COLS&&row>=0&&row<WORLD_ROWS){var worldIndexUnderCoord=rowColToArrayIndex(col,row);return worldMap[worldIndexUnderCoord]}return WORLD_WALL}function getTileIndexAtPixelCoord(atX,atY){var warriorWorldCol=Math.floor(atX/WORLD_W),warriorWorldRow=Math.floor(atY/WORLD_H),worldIndexUnderWarrior=rowColToArrayIndex(warriorWorldCol,warriorWorldRow);if(warriorWorldCol>=0&&warriorWorldCol<WORLD_COLS&&warriorWorldRow>=0&&warriorWorldRow<WORLD_ROWS)return worldIndexUnderWarrior}function rowColToArrayIndex(col,row){return col+WORLD_COLS*row}function tileTypeHasTransparency(checkTileType){return checkTileType==TILE_WALL||checkTileType==TILE_WALL1||checkTileType==TILE_WALL2||checkTileType==TILE_DOOR_NEXT||checkTileType==TILE_DOOR_PREV||checkTileType==TILE_INBAG||checkTileType==TILE_BARRIER||checkTileType==TILE_BARRIER2||checkTileType==TILE_BARRIER3||checkTileType==TILE_BARRIER4||checkTileType==TILE_BARRIER5||checkTileType==TILE_BARRIER6||checkTileType==TILE_BARRIER7||checkTileType==TILE_BARRIER8||checkTileType==TILE_BARRIER9}function drawWorlds(){for(var arrayIndex=0,drawTileX=0,drawTileY=0,eachRow=0;eachRow<WORLD_ROWS;eachRow++){for(var eachCol=0;eachCol<WORLD_COLS;eachCol++){arrayIndex=rowColToArrayIndex(eachCol,eachRow);var tileKindHere=worldMap[arrayIndex],useImg=worldPics[tileKindHere];tileTypeHasTransparency(tileKindHere)&&canvasContext.drawImage(worldPics[TILE_ROAD],drawTileX,drawTileY),canvasContext.drawImage(useImg,drawTileX,drawTileY),drawTileX+=WORLD_W,arrayIndex++}drawTileY+=WORLD_H,drawTileX=0}}
const KEY_W=87,KEY_A=65,KEY_S=83,KEY_D=68;function setupInput(){document.addEventListener("keydown",keyPressed),document.addEventListener("keyup",keyReleased),superWarrior.setupInput(KEY_W,KEY_D,KEY_S,KEY_A)}function keySet(keyEvent,setTo){document.querySelector("body").classList.contains("active-modal")||(keyEvent.keyCode==superWarrior.controlKeyLeft&&(superWarrior.keyHeld_West=setTo),keyEvent.keyCode==superWarrior.controlKeyRight&&(superWarrior.keyHeld_East=setTo),keyEvent.keyCode==superWarrior.controlKeyUp&&(superWarrior.keyHeld_North=setTo),keyEvent.keyCode==superWarrior.controlKeyDown&&(superWarrior.keyHeld_South=setTo)),32!=keyEvent.keyCode&&13!=keyEvent.keyCode&&27!=keyEvent.keyCode||closeModal()}function keyPressed(evt){keySet(evt,!0),evt.preventDefault()}function keyReleased(evt){keySet(evt,!1)}
var canvas,canvasContext,body=document.querySelector("body"),superWarrior=new warriorClass;function ImageLoadingDoneToStartGame(){setInterval(updateAll,1e3/30),setupInput(),loadLevel(levelList[levelNow])}function nextLevel(){levelNow++,levelNow>=levelList.length&&(body.classList.add("active-modal"),document.getElementById("goodByeModal").classList.add("active"),levelNow=0),loadLevel(levelList[levelNow])}function prevLevel(){levelNow--,levelNow<0&&(levelNow=0),loadLevel(levelList[levelNow])}function loadLevel(whichLevel){worldMap=whichLevel.slice(),superWarrior.reset(warriorPic,"")}function updateAll(){moveAll(),drawAll()}function moveAll(){superWarrior.move()}function drawAll(){drawWorlds(),superWarrior.draw()}window.onload=function(){canvas=document.getElementById("gameCanvas"),canvasContext=canvas.getContext("2d"),loadImages(),body.classList.add("clear-modal"),setTimeout(function(){body.classList.remove("clear-modal"),document.getElementById("preloader").classList.remove("active"),document.getElementById("greetingsModal").classList.add("active")},300)};for(var modals=document.querySelectorAll(".close-modal, .shadow"),i=0;i<modals.length;i++)modals[i].addEventListener("click",function(){closeModal()});function closeModal(){body.classList.add("clear-modal"),setTimeout(function(){body.classList.remove("clear-modal"),body.classList.remove("active-modal");for(var modalList=document.querySelectorAll(".modal"),i=0;i<modalList.length;i++)modalList[i].classList.remove("active")},300)}